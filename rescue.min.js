/* JQuery Rescue - Mike Simmonds - https://github.com/MikeSimmonds/JQuery-Rescue */
(function(a){a.fn.rescue=function(b){var c=function(){try{var a="a";localStorage.setItem(a,a);localStorage.removeItem(a);a=JSON.stringify(a);JSON.parse(a);return true}catch(b){return false}};var d={timer:1e3,exclude:"",saving:function(){},saved:function(a){},load:function(){},"delete":function(){},error:function(a,b){if(typeof console.log=="function")console.log("Error ("+a+"): "+b)}};var e={init:function(b){if(b)a.extend(d,b);if(!c()){d.error("1","Insufficient browser support");return}if(typeof localStorage.setObject=="undefined")Storage.prototype.setObject=function(a,b){return this[a]=JSON.stringify(b)};if(typeof localStorage.getObject=="undefined")Storage.prototype.getObject=function(a){return JSON.parse(this[a])};return this.each(function(b){var c=a(this);if(!c.prop("id"))a.error("Form (#"+c.index()+") does not have an ID. An ID is required for jQuery.rescue.");if(!c.data("rescue")){c.data("rescue",{}).bind({"submit.rescue":function(){e.stop.apply(c);e.delete.apply(c)},"reset.rescue":function(){e.stop.apply(c);e.delete.apply(c);e.start.apply(c)}});e.update.apply(c);if(localStorage[c.prop("id")])e.load.apply(c);c.data("rescue").initial_data=JSON.stringify(c.data("rescue").fields.serializeArray());e.start.apply(c)}})},update:function(){return this.each(function(b){var c=a(this);c.data("rescue").fields=c.find("select[name],input[name]:not([type=submit],[type=reset],[type=button]),textarea[name]");if(d.exclude)c.data("rescue").fields.not(d.exclude);c.data("rescue").fields.bind("change.rescue keyup.rescue",function(){e.save.apply(c)})})},start:function(){return this.each(function(b){var c=a(this);if(d.timer)c.data("rescue").timer=setInterval(function(){e.save.apply(c)},d.timer)})},stop:function(){return this.each(function(b){var c=a(this);clearInterval(c.data("rescue").timer)})},save:function(){return this.each(function(){var b=a(this),c=b.data("rescue").fields.serializeArray(),e=new Date;if(!localStorage[b.prop("id")]&&b.data("rescue").initial_data===JSON.stringify(c))return;d.saving();localStorage.setObject(b.prop("id"),{form:{saved:Math.ceil(e.getTime()),url:b.prop("action"),method:b.prop("method"),id:b.prop("id")},data:c});d.saved(e)})},load:function(){return this.each(function(){var b=a(this),c={};if(!localStorage[b.prop("id")])return;a.each(localStorage.getObject(b.prop("id")).data,function(a,b){c[b.name]=b.value});b.data("rescue").fields.each(function(b,d){var e=a(d),f=c[e.prop("name")];if(f!==false){if(e.is(":radio")){e.filter('[value="'+f+'"]').prop("checked",true)}else if(e.is(":checkbox")){e.prop("checked",e.val()===f?true:false)}else if(e.is("select")){e.find('option[value="'+f+'"]').prop("selected",true)}else{e.val(f)}e.trigger("change")}});e.delete.apply(b);d.load()})},"delete":function(){return this.each(function(){var b=a(this);localStorage.removeItem(b.prop("id"));d.delete()})},destroy:function(){return this.each(function(){var b=a(this);e.stop.apply(b);b.unbind(".rescue").removeData("rescue")})}};if(e[b]){return e[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return e.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.rescue")}}})(jQuery)