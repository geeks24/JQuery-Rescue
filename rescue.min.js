/* JQuery Rescue - Mike Simmonds - https://github.com/MikeSimmonds/JQuery-Rescue */
(function(a){a.fn.rescue=function(b){var c={timer:1e3,exclude:"",saving:function(){},saved:function(a){},load:function(){},"delete":function(){},error:function(a,b){if(typeof console.log=="function")console.log("Error ("+a+"): "+b)}};var d={init:function(b){if(b)a.extend(c,b);if(typeof JSON.stringify=="undefined"||typeof JSON.parse=="undefined"){c.error("1","JSON library required - Not supported by browser");return}if(typeof localStorage=="undefined"){c.error("2","localStorage required - Not supported by browser");return}else{if(typeof localStorage.setObject=="undefined")Storage.prototype.setObject=function(a,b){return this[a]=JSON.stringify(b)};if(typeof localStorage.getObject=="undefined")Storage.prototype.getObject=function(a){return JSON.parse(this[a])}}return this.each(function(b){var c=a(this);if(!c.prop("id"))a.error("Form (#"+c.index()+") does not have an ID. An ID is required for jQuery.rescue.");if(!c.data("rescue")){c.data("rescue",{}).bind("submit.rescue",function(){d.stop.apply(c);d.delete.apply(c)});d.update.apply(c);if(localStorage[c.prop("id")])d.load.apply(c);c.data("rescue").initial_data=JSON.stringify(c.data("rescue").fields.serializeArray());d.start.apply(c)}})},update:function(){return this.each(function(b){var e=a(this);e.data("rescue").fields=e.find("select[name], input[name], textarea[name]");if(c.exclude)e.data("rescue").fields.not(c.exclude);e.data("rescue").fields.bind("change.rescue keyup.rescue",function(){d.save.apply(e)})})},start:function(){return this.each(function(b){var e=a(this);if(c.timer)e.data("rescue").timer=setInterval(function(){d.save.apply(e)},c.timer)})},stop:function(){return this.each(function(b){var c=a(this);clearInterval(c.data("rescue").timer)})},save:function(){return this.each(function(){var b=a(this),d=b.data("rescue").fields.serializeArray(),e=new Date;if(!localStorage[b.prop("id")]&&b.data("rescue").initial_data===JSON.stringify(d))return;c.saving();localStorage.setObject(b.prop("id"),{form:{saved:Math.ceil(e.getTime()),url:b.prop("action"),method:b.prop("method"),id:b.prop("id")},data:d});c.saved(e)})},load:function(){return this.each(function(){var b=a(this),e={};if(!localStorage[b.prop("id")])return;a.each(localStorage.getObject(b.prop("id")).data,function(a,b){e[b.name]=b.value});b.data("rescue").fields.each(function(b,c){var d=a(c),f=e[d.prop("name")];if(f!==false){if(d.is(":radio")){d.filter('[value="'+f+'"]').prop("checked",true)}else if(d.is(":checkbox")){d.prop("checked",d.val()===f?true:false)}else if(d.is("select")){d.find('option[value="'+f+'"]').prop("selected",true)}else{d.val(f)}d.trigger("change")}});d.delete.apply(b);c.load()})},"delete":function(){return this.each(function(){var b=a(this);localStorage.removeItem(b.prop("id"));c.delete()})},destroy:function(){return this.each(function(){var b=a(this);d.stop.apply(b);b.unbind(".rescue").removeData("rescue")})}};if(d[b]){return d[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return d.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.rescue")}}})(jQuery)